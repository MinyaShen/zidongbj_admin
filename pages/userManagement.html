<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport"
		content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="format-detection" content="telephone=no">
	<title>用户管理</title>
	<!-- 引入css -->
	<link rel="stylesheet" type="text/css" href="../static/layui/css/layui.css" />
	<link rel="stylesheet" type="text/css" href="../static/css/public.css" />
	<link rel="stylesheet" type="text/css" href="../static/css/table.css" />
</head>

<style>
	#layerAddUser {
		display: none;
		padding: 20px;
	}

	#layerAddUser .layui-form-label {
		width: 40px;
	}

	#layerAddUser .layui-input-block {
		margin-left: 80px;
	}
</style>

<div id="layerAddUser" class="layui-form">
	<div class="layui-form-item">
		<label class="layui-form-label">账号</label>
		<div class="layui-input-block">
			<input id="username" type="text" required lay-verify="required" placeholder="请输入账号" autocomplete="off"
				class="layui-input">
		</div>
	</div>

	<div class="layui-form-item">
		<label class="layui-form-label">密码</label>
		<div class="layui-input-block">
			<input id="password" type="password" required lay-verify="required" placeholder="请输入密码" autocomplete="off"
				class="layui-input">
		</div>
	</div>

	<div class="layui-form-item">
		<label class="layui-form-label">姓名</label>
		<div class="layui-input-block">
			<input id="name" type="text" required lay-verify="required" placeholder="请输入姓名" autocomplete="off"
				class="layui-input">
		</div>
	</div>

	<div class="layui-form-item">
		<label class="layui-form-label">电话</label>
		<div class="layui-input-block">
			<input id="tel" type="text" required lay-verify="required" placeholder="请输入电话" autocomplete="off"
				class="layui-input">
		</div>
	</div>

	<div class="layui-form-item">
		<label class="layui-form-label">身份</label>
		<div class="layui-input-block">
			<select id="roleType" lay-verify="required">
				<option value=""></option>
				<option value="-1">管理员</option>
				<option value="1">总网点</option>
				<option value="2">支网点</option>
				<option value="3">维修人员</option>
			</select>
		</div>
	</div>

	<div class="layui-input-block">
		<button class="layui-btn" id="addUser">确定</button>
	</div>

</div>

<body>
	<div class="alarm-wrapper">
		<h3 class="alarm-page-title">用户管理</h3>
		<div class="alarm-content">
			<div class="alarm-table-toolbar">
				<div class="layui-form alarm-filter-form">
					<div class="layui-form-item">
						<label class="layui-form-label">关键字：</label>
						<div class="layui-input-block">
							<input id="keyword" type="text" required lay-verify="required" placeholder="请输入关键字"
								autocomplete="off" class="layui-input">
						</div>
					</div>

					<div class="layui-form-item alarm-form-btns">
						<div class="layui-input-block">
							<button id="search" data-type="search"
								class="layui-btn alarm-btn-primary alarm-btn-size alarm-btn-search">查询</button>
						</div>
					</div>
				</div>

				<div class="t-head-toolbar-btn">
					<button id="openAddUser" type="button"
						class="layui-btn alarm-btn-size alarm-btn-success">添加</button>
					<button type="button" class="layui-btn alarm-btn-size alarm-btn-danger">删除</button>
				</div>
			</div>
			<table id="noticeData" lay-filter="noticeData"></table>
			<script type="text/html" id="tableBar">
				<a href="javascript:;" class="alarm-text-success" lay-event="edit">编辑</a>
			</script>
		</div>
	</div>

	<script src="../static/layui/layui.js"></script>
	<script src="../static/js/jquery.min.js"></script>
	<script>
		layui.use(['laypage', 'jquery', 'table', 'form', 'layer'], function () {
			var table = layui.table;
			var layer = layui.layer; // 弹出层组件引入

			//添加用户
			layui.$("#openAddUser").on('click', function () {
				layer.open({
					type: 1,
					title: "信息编辑",
					area: ['600px', '400px'],
					content: $('#layerAddUser')
				});
			})

			layui.$("#addUser").on('click', function () {
				var data = {
					username: $("#username").val(),
					password: $("#password").val(),
					tel: $("#tel").val(),
					name: $("#name").val(),
					roleType: $("#roleType").val()
				}

				$.ajax({
					url: "http://192.168.0.27/alarm/user/addUser",
					data: JSON.stringify(data),
					method: 'POST',
					contentType: 'application/json',
					success: function (result) {
						layer.close(layer.index);
					}
				});
			})


			//表格渲染
			table.render({
				elem: '#noticeData',
				url: 'http://192.168.0.27/alarm/user/queryUsers',
				page: true,
				skin: 'line',
				limit: 10,
				// limits: [10, 20, 30, 40, 50, 60, 70, 80, 90],
				where: { //设定异步数据接口的额外参数，任意设
					keyword: $('#keyword').val()
				},
				request: {
					pageName: 'pageNum', //页码的参数名称，默认：page
					limitName: 'pageSize' //每页数据量的参数名，默认：limit
				},
				parseData: function (res) {
					console.log(res);
					return {
						"code": 0,
						"msg": '',
						"count": res.data.total,
						"data": res.data.list,
					}
				},
				cols: [
					[ //表头
						{
							type: 'checkbox',
							fixed: 'left',
						},
						{
							field: 'userId',
							title: '账号',
						}, {
							field: 'name',
							title: '姓名',
						}, {
							field: 'roleName',
							title: '身份',
						}, {
							field: 'tel',
							title: '电话',
						}, {
							field: 'eval',
							title: '星级',
							sort: true
						}, {
							fixed: 'right',
							title: '操作',
							toolbar: '#tableBar'
						}
					]
				]
			});
			//搜索按钮监听
			layui.$('#search').on('click', function () {
				var keyword = $("#keyword").val();
				var data = {
					keyword: keyword
				};
				// 重载数据
				table.reload('noticeData', {
					where: data,
					page: {
						curr: 1 //从第一页开始
					},
					url: 'http://192.168.0.27/alarm/user/queryUsers'
				});
			})

		});
	</script>
</body>

</html>