<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="apple-mobile-web-app-capable" content="yes">	
		<meta name="format-detection" content="telephone=no">	
		<title>故障维护</title>
		<!-- 引入css -->
		<link rel="stylesheet" type="text/css" href="../static/layui/css/layui.css" />
		<link rel="stylesheet" type="text/css" href="../static/css/public.css" />
		<link rel="stylesheet" type="text/css" href="../static/css/detail_table.css" />
	</head>
	<body>
		<div class="alarm-wrapper">
			<h3 class="alarm-page-title">故障维护详情信息</h3>
			<div class="alarm-content">
				<div class="alarm-table-toolbar">
					<button type="button" id="back-btn" class="layui-btn alarm-btn-size alarm-btn-danger">返回</button>
				</div>
				<div class="alarm-table">
					<div class="layui-row alarm-row">
						<div class="layui-col-md2 alarm-col col-title">点位名称</div>
						<div class="layui-col-md4 alarm-col col-content" id="clientName"></div>
						<div class="layui-col-md2 alarm-col col-title">地址</div>
						<div class="layui-col-md4 alarm-col col-content" id="clientAddress"></div>
					</div>
					<div class="layui-row alarm-row">
						<div class="layui-col-md2 alarm-col col-title">质保时间</div>
						<div class="layui-col-md4 alarm-col col-content" id="expirationDate"></div>
						<div class="layui-col-md2 alarm-col col-title">故障类型</div>
						<div class="layui-col-md4 alarm-col col-content" id="damageTypeName"></div>
					</div>
					<div class="layui-row alarm-row">
						<div class="layui-col-md2 alarm-col col-title col-title-over">故障描述</div>
						<div class="layui-col-md10 alarm-col col-content" id="damageDesc"></div>
					</div>
					<div class="layui-row alarm-row">
						<div class="layui-col-md2 alarm-col col-title col-title-img">故障照片</div>
						<div class="layui-col-md10 alarm-col col-content">
							<ul class="show-img-list" id="damageImgList"></ul>
						</div>
					</div>
					<div class="layui-row alarm-row">
						<div class="layui-col-md2 alarm-col col-title col-title-over">维修描述</div>
						<div class="layui-col-md10 alarm-col col-content" id="repairDesc"></div>
					</div>
					<div class="layui-row alarm-row">
						<div class="layui-col-md2 alarm-col col-title col-title-img">维修照片</div>
						<div class="layui-col-md10 alarm-col col-content">
							<ul class="show-img-list" id="repairImgList"></ul>
						</div>
					</div>
					<div class="layui-row alarm-row">
						<div class="layui-col-md2 alarm-col col-title col-title-over">责任人签字</div>
						<div class="layui-col-md4 alarm-col col-content col-content-over" id="signImgBox"></div>
						<div class="layui-col-md2 alarm-col col-title col-title-over">评价星级</div>
						<div class="layui-col-md4 alarm-col col-content col-content-over" id="assess"></div>
					</div>
					<div class="layui-row alarm-row">
						<div class="layui-col-md2 alarm-col col-title">上报时间</div>
						<div class="layui-col-md2 alarm-col col-title">接单时间</div>
						<div class="layui-col-md2 alarm-col col-title">签到时间</div>
						<div class="layui-col-md2 alarm-col col-title">维修时间</div>
						<div class="layui-col-md2 alarm-col col-title">提交时间</div>
						<div class="layui-col-md2 alarm-col col-title">评价时间</div>
					</div>
					<div class="layui-row alarm-row">
						<div class="layui-col-md2 alarm-col col-content" id="upTime"></div>
						<div class="layui-col-md2 alarm-col col-content" id="orderTime"></div>
						<div class="layui-col-md2 alarm-col col-content" id="signTime"></div>
						<div class="layui-col-md2 alarm-col col-content" id="repairTime"></div>
						<div class="layui-col-md2 alarm-col col-content" id="postTime"></div>
						<div class="layui-col-md2 alarm-col col-content" id="assessTime"></div>
					</div>
				</div>
			</div>
		</div>
		
		<script src="../static/layui/layui.js"></script>
		<script src="../static/js/common.js"></script>
		<script>
			// 定义全局变量参数
			var pathId = getQueryString('id');
			var faultData = {};
			
			// 加载layui模块
			layui.use(['jquery', 'layer', 'rate'], function(){
				var $ = layui.jquery,
				layer = layui.layer,
				rate = layui.rate
				
				// 加载数据
				getfaultDataDetail($, pathId, rate)
				
				
				// 返回
				goBack($, '#back-btn')
				
			});
			
			// 获取故障维护详情
			function getfaultDataDetail($, id, rate) {
				console.log(pathId)
				ajaxfuntion($, baseUrl + '/maintain/maintainInfo',
					{
						maintainId: id
					},
					'get',
					function (res) {
						if (res.code == 200) {
							console.log(res)
							faultData = res.data
							var device= res.data.maintainRocord
							$('#clientName').text(faultData.fullName)
							$('#clientAddress').text(faultData.address)
							if(faultData.warrantyEndTime) {
								$('#expirationDate').text(formatTime(faultData.warrantyEndTime))
							}
							$('#damageTypeName').text(device.damageTypeName)
							$('#damageDesc').text(device.damageInfo)
							if (JSON.parse(device.damageImg).length > 0) {
								JSON.parse(device.damageImg).forEach(function(item, index) {
									console.log(item)
									$('#damageImgList').append('<li class="img-box"><img src="' + imgBaseUrl + item +'"></li>')
								})
							}
							$('#repairDesc').text(device.repairInfo)
							if(JSON.parse(device.repairImg).length > 0) {
								JSON.parse(device.repairImg).forEach(function(item, index) {
									console.log(item)
									$('#repairImgList').append('<li class="img-box"><img src="' + imgBaseUrl + item +'"></li>')
								})
							}
							if(device.signature != null) {
								$('#signImgBox').append('<li class="sign-img-box"><img src="' + imgBaseUrl + device.signature +'"></li>')
							}
							$('#assess').append('<div id="star'+ id +'" style="font-size: 13px; margin-top: -10px;"></div>')
							// 加载评分
							var average = avg(device.evalLevel1, device.evalLevel2)
							rate.render({
								elem: '#star'+id+''
								, length: 5
								, value: average
								//, theme: '#009688'
								, half: true
								, text: true
								, readonly: true
							});
							if(device.reportTime) {
								$('#upTime').text(formatTime(device.reportTime))
							}
							if(device.orderTakeTime) {
								$('#orderTime').text(formatTime(device.orderTakeTime))
							}
							if(device.signTime) {
								$('#signTime').text(formatTime(device.signTime))
							}
							if(device.maintainTime) {
								$('#repairTime').text(formatTime(device.maintainTime))
							}
							if(device.submitTime) {
								$('#postTime').text(formatTime(device.submitTime))
							}
							if(device.evalTime) {
								$('#assessTime').text(formatTime(device.evalTime))
							}
						}
					},
					function (res) {},
					function (res) {}
				)
			};
		</script>
	</body>
</html>
